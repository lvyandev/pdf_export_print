# 常用模式和最佳实践

- 子表图片展示功能实现：扩展TableField支持CellContent抽象类，包含TextContent和ImageContent；使用CellRenderer策略模式处理不同内容类型；图片使用BoxFit.fitWidth撑满列宽；保持向后兼容性
- 图片识别问题修复：TypeSafeDataAdapter的_isImageData方法需要支持picsum.photos等图片服务域名，添加了imageServiceDomains列表和_isImageField方法检查字段名中的图片关键词
- 图片显示问题根因：TypeSafeDataAdapter在第514行强制将所有数据转换为字符串(itemMap[originalHeader]?.toString())，导致Map类型的图片数据被转换为字符串，需要保持原始数据类型
- 图片适配模式简化：删除了ImageFit枚举和所有fit相关配置，图片现在直接撑满列宽显示，高度自适应，简化了实现和使用方式
- 类型转换错误修复：为所有配置类（LogoConfig、TitleConfig、MainTableConfig、SubTableConfig、FooterConfig）添加了完整的copyWith方法，改进了AdapterModuleConfig的getTypedModuleConfig方法添加类型安全检查，避免强制类型转换异常
- PDF构建器模块渲染优化：使用预处理+单循环替代嵌套循环，通过创建包含优先级信息的描述符列表实现高效排序和处理，支持一对多的ModuleType到ModuleDescriptor映射关系
- 图片显示问题修复：TypeSafeDataAdapter的_createSubTableData方法保持原始数据类型，通过_createTableFieldWithImageDetection方法智能识别图片URL和字段名关键词，自动创建ImageContent替代强制字符串转换，支持picsum.photos等图片服务域名识别
- 字段标签映射架构增强：FieldLabelConfig新增enhanced()构造函数支持嵌套Map结构，实现全局映射和模块特定映射的分层配置，查找优先级为模块特定>全局>原始key，TypeSafeDataAdapter调用时传递moduleId上下文，完全向后兼容现有custom()方法
- SubTableConfig中的reservedHeight参数是僵尸参数，仅在配置类中定义但从未在任何渲染逻辑中使用，应该彻底移除以简化配置
- LogoConfig中的enableCache、timeoutSeconds、requestHeaders参数是僵尸参数，在LogoModule._loadImageFromUrl方法中完全未使用，已清理移除
- FieldConfig中的required参数是僵尸参数，虽然在文档中提到验证逻辑，但实际代码中没有实现相关验证功能，已清理移除
- FooterConfig中的cellHeight、labelAlignment、contentAlignment参数是僵尸参数，在CustomTableLayout中不支持这些参数，已清理移除
- MainTableConfig中的fieldsPerRow参数传递问题已修复，MainTableModule现在正确使用该参数设置CustomTableConfig的maxColumnsPerRow
- 文档更新：已修复使用指南中FieldConfig示例的错误，移除了已删除的required参数，保持文档与代码的一致性
- ImageCellRenderer对齐问题修复：ImageCellRenderer在渲染图片时缺少pw.Align包装，导致dataAlignment配置无效，修复后图片渲染器正确使用context.config.dataAlignment参数进行对齐
- Table垂直对齐问题修复：为SubTableConfig和CommonTableConfig添加cellVerticalAlignment参数，默认值为middle，解决pw.Table默认使用top对齐导致单元格内容显示在行高顶部的问题，现在单元格内容在行高内垂直居中显示
