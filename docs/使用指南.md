# PDF Export Print ä½¿ç”¨æŒ‡å—

åŸºäºç±»å‹å®‰å…¨æ¶æ„çš„å®Œæ•´åŠŸèƒ½ä½¿ç”¨æ–‡æ¡£

## ğŸ—ï¸ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PDFæ„å»ºå™¨     â”‚â”€â”€â”€â–¶â”‚   PDFé…ç½®ç±»     â”‚    â”‚   PDFä¸Šä¸‹æ–‡     â”‚
â”‚  (pdf_builder)  â”‚    â”‚ (pdf_config)    â”‚    â”‚ (pdf_context)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â–²
         â–¼                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   PDFæ¨¡å—åŸºç±»   â”‚    â”‚  æ¨¡å—æè¿°ç¬¦     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (pdf_module)   â”‚    â”‚(module_descriptor)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â–²
         â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å…·ä½“æ¨¡å—      â”‚    â”‚  æ•°æ®é€‚é…å™¨     â”‚
â”‚ (title/logo/    â”‚    â”‚ (data_adapter)  â”‚
â”‚  table/footer)  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¡¨æ ¼ç»„ä»¶      â”‚    â”‚   å•å…ƒæ ¼æ¸²æŸ“    â”‚
â”‚(table_layout)   â”‚    â”‚ (cell_renderer) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ†• æœ€æ–°æ¶æ„ç‰¹æ€§

- **ğŸ—ï¸ ç±»å‹å®‰å…¨æ¶æ„**ï¼šåŸºäº TypeSafeDataAdapter å’Œ ModuleDescriptor çš„å¼ºç±»å‹ç³»ç»Ÿ
- **ğŸ”’ æ¨¡å—åŒ–è®¾è®¡**ï¼šPDFæ„å»ºå™¨åè°ƒå„ä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ”¯æŒæ’ä»¶å¼æ‰©å±•
- **ğŸ§  æ™ºèƒ½æ•°æ®è§£æ**ï¼šSubTableData è‡ªåŠ¨è§£æå¤æ‚æ•°æ®ç»“æ„ï¼Œå®Œæ•´ä¿å­˜å›¾ç‰‡ã€åˆ—å®½ã€æ’åºç­‰ä¿¡æ¯
- **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šç»„ä»¶ç›´æ¥åŸºäº TableField å†…ç½®å±æ€§å·¥ä½œï¼Œç§»é™¤å†—ä½™ä¾èµ–
- **ğŸ¯ å›¾ç‰‡å±•ç¤ºåŠŸèƒ½**ï¼šå­è¡¨ç»„ä»¶æ”¯æŒå›¾ç‰‡è‡ªé€‚åº”ç¼©æ”¾ï¼Œä¿æŒè¡¨æ ¼å¸ƒå±€å®Œæ•´æ€§

## ğŸ“‹ ç›®å½•

- [1. æ¶æ„è®¾è®¡åŸç†](#1-æ¶æ„è®¾è®¡åŸç†)
- [2. æ ¸å¿ƒç»„ä»¶è¯¦è§£](#2-æ ¸å¿ƒç»„ä»¶è¯¦è§£)
- [3. æ•°æ®æ¨¡å‹ç³»ç»Ÿ](#3-æ•°æ®æ¨¡å‹ç³»ç»Ÿ)
- [4. æ¨¡å—ç³»ç»Ÿè¯¦è§£](#4-æ¨¡å—ç³»ç»Ÿè¯¦è§£)
- [5. å›¾ç‰‡å±•ç¤ºåŠŸèƒ½](#5-å›¾ç‰‡å±•ç¤ºåŠŸèƒ½)
- [6. é…ç½®ç®¡ç†ç³»ç»Ÿ](#6-é…ç½®ç®¡ç†ç³»ç»Ÿ)
- [7. å®Œæ•´ä½¿ç”¨ç¤ºä¾‹](#7-å®Œæ•´ä½¿ç”¨ç¤ºä¾‹)
- [8. å¼€å‘è€…æ‰©å±•æŒ‡å—](#8-å¼€å‘è€…æ‰©å±•æŒ‡å—)
- [9. æœ€ä½³å®è·µ](#9-æœ€ä½³å®è·µ)
- [10. æ•…éšœæ’é™¤](#10-æ•…éšœæ’é™¤)

---

## 1. æ¶æ„è®¾è®¡åŸç†

### 1.1 åˆ†å±‚æ¶æ„è®¾è®¡

PDF Export Print é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œç¡®ä¿ç»„ä»¶èŒè´£æ¸…æ™°ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼š

```dart
// ğŸ—ï¸ æ„å»ºå±‚ï¼šPDFæ„å»ºå™¨ä½œä¸ºæ ¸å¿ƒè°ƒåº¦å™¨
PDFPrintBuilder
â”œâ”€â”€ é…ç½®ç®¡ç† (PDFConfig)
â”œâ”€â”€ ä¸Šä¸‹æ–‡ç®¡ç† (PDFContext)
â””â”€â”€ æ¨¡å—åè°ƒ (PDFModule[])

// ğŸ”§ é€‚é…å±‚ï¼šæ•°æ®é€‚é…å’Œç±»å‹è½¬æ¢
TypeSafeDataAdapter
â”œâ”€â”€ æ¨¡å—æè¿°ç¬¦ (ModuleDescriptor)
â”œâ”€â”€ é…ç½®ç®¡ç† (DataAdapterConfig)
â””â”€â”€ æ•°æ®éªŒè¯å’Œè½¬æ¢

// ğŸ¨ æ¸²æŸ“å±‚ï¼šå…·ä½“çš„å†…å®¹æ¸²æŸ“
Modules (Title/Logo/Table/Footer)
â”œâ”€â”€ è¡¨æ ¼å¸ƒå±€ (CustomTableLayout)
â”œâ”€â”€ å•å…ƒæ ¼æ¸²æŸ“ (CellRenderer)
â””â”€â”€ æ ·å¼ä¸»é¢˜ (Themes)
```

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### **å•ä¸€èŒè´£åŸåˆ™**
- **PDFæ„å»ºå™¨**ï¼šè´Ÿè´£åè°ƒå„ä¸ªæ¨¡å—çš„æ¸²æŸ“ï¼Œæä¾›ç»Ÿä¸€çš„PDFç”Ÿæˆæ¥å£
- **æ•°æ®é€‚é…å™¨**ï¼šä¸“æ³¨äºæ•°æ®è½¬æ¢å’Œç±»å‹å®‰å…¨ï¼Œæ”¯æŒæ¨¡å—åŒ–é…ç½®
- **æ¸²æŸ“æ¨¡å—**ï¼šå„æ¨¡å—ä¸“æ³¨äºè‡ªèº«çš„æ¸²æŸ“é€»è¾‘ï¼Œäº’ä¸å¹²æ‰°
- **è¡¨æ ¼ç»„ä»¶**ï¼šä¸“é—¨å¤„ç†è¡¨æ ¼å¸ƒå±€å’Œå•å…ƒæ ¼æ¸²æŸ“ï¼Œæ”¯æŒå›¾ç‰‡å±•ç¤º

#### **ä¾èµ–å€’ç½®åŸåˆ™**
```dart
// é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
abstract class PDFModule {
  Future<List<pw.Widget>> render(ModuleDescriptor descriptor, PDFContext context);
  bool canRender(ModuleDescriptor descriptor);
}

// å…·ä½“å®ç°ä¾èµ–æŠ½è±¡æ¥å£
class SubTableModule implements PDFModule {
  // å®ç°å…·ä½“çš„å­è¡¨æ¸²æŸ“é€»è¾‘
}
```

#### **å¼€é—­åŸåˆ™**
- å¯¹æ‰©å±•å¼€æ”¾ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ¨¡å—ç±»å‹
- å¯¹ä¿®æ”¹å°é—­ï¼šç°æœ‰æ¨¡å—çš„ä¿®æ”¹ä¸å½±å“å…¶ä»–ç»„ä»¶

### 1.3 æ•°æ®æµæ¶æ„

```
åŸå§‹æ•°æ® â†’ TypeSafeDataAdapter â†’ ModuleDescriptor â†’ PDFModule â†’ PDFæ–‡æ¡£
   â†“              â†“                    â†“           â†“         â†“
æ¥å£æ•°æ®      ç±»å‹å®‰å…¨è½¬æ¢          ç»“æ„åŒ–æ•°æ®    ä¸“ä¸šæ¸²æŸ“   æœ€ç»ˆè¾“å‡º
Mapæ ¼å¼      é…ç½®é©±åŠ¨é€‚é…          æ¨¡å—æè¿°ç¬¦    ç»„ä»¶åè°ƒ   PDFæ–‡ä»¶
```

## 2. æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 2.1 PDFæ„å»ºå™¨ (PDFPrintBuilder)

PDFæ„å»ºå™¨æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒè°ƒåº¦å™¨ï¼Œè´Ÿè´£åè°ƒå„ä¸ªæ¨¡å—çš„æ¸²æŸ“ï¼š

```dart
// æ ¸å¿ƒèŒè´£
class PDFPrintBuilder {
  // 1. é…ç½®ç®¡ç†ï¼šç»Ÿä¸€ç®¡ç†PDFæ–‡æ¡£çš„å…¨å±€é…ç½®
  PDFConfig config;

  // 2. æ¨¡å—åè°ƒï¼šæŒ‰ä¼˜å…ˆçº§é¡ºåºè°ƒç”¨å„ä¸ªæ¨¡å—
  List<PDFModule> modules;

  // 3. ä¸Šä¸‹æ–‡ç»´æŠ¤ï¼šä¸ºå„æ¨¡å—æä¾›ç»Ÿä¸€çš„è¿è¡Œæ—¶ç¯å¢ƒ
  PDFContext context;

  // 4. æ•°æ®é€‚é…ï¼šé€šè¿‡é€‚é…å™¨è·å–ç»“æ„åŒ–æ•°æ®
  DataAdapter dataAdapter;
}
```

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒæ¨¡å—åŒ–é…ç½®å’Œä¸»é¢˜ç³»ç»Ÿ
- æä¾›ç»Ÿä¸€çš„PDFç”Ÿæˆæ¥å£
- ç®¡ç†æ¨¡å—é—´çš„ä¾èµ–å…³ç³»å’Œæ‰§è¡Œé¡ºåº

### 2.2 æ•°æ®é€‚é…å™¨ (TypeSafeDataAdapter)

æ•°æ®é€‚é…å™¨è´Ÿè´£å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºç±»å‹å®‰å…¨çš„æ¨¡å—æ•°æ®ï¼š

```dart
// æ ¸å¿ƒåŠŸèƒ½
class TypeSafeDataAdapter {
  // 1. æ¨¡å—æ•°æ®é€‚é…ï¼šå°†ModuleDescriptoré€‚é…ä¸ºå…·ä½“çš„æ¨¡å—æ•°æ®ç±»å‹
  ModuleDescriptor? adaptModuleData(ModuleDescriptor descriptor);

  // 2. æ¨¡å—å®ä¾‹é€‚é…ï¼šå°†ModuleDescriptoré€‚é…ä¸ºå¯¹åº”çš„PDFModule
  PDFModule? adaptModule(ModuleDescriptor descriptor);

  // 3. é…ç½®é©±åŠ¨ï¼šåŸºäºDataAdapterConfigè¿›è¡Œæ•°æ®æ˜ å°„
  DataAdapterConfig config;

  // 4. æ¨¡å—æ”¯æŒæŸ¥è¯¢ï¼šè·å–æ”¯æŒçš„æ¨¡å—ç±»å‹åˆ—è¡¨
  List<String> getSupportedModules();
}
```

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒç±»å‹å®‰å…¨çš„æ•°æ®è½¬æ¢
- é…ç½®é©±åŠ¨çš„å­—æ®µæ˜ å°„å’Œæ ‡ç­¾ç®¡ç†
- æ™ºèƒ½æ•°æ®è§£æå’ŒéªŒè¯

### 2.3 æ¨¡å—æè¿°ç¬¦ (ModuleDescriptor)

æ¨¡å—æè¿°ç¬¦å®šä¹‰æ¨¡å—çš„å…ƒæ•°æ®å’Œé…ç½®ä¿¡æ¯ï¼š

```dart
// æ ¸å¿ƒç»“æ„
class ModuleDescriptor {
  // 1. æ¨¡å—ç±»å‹ï¼šæ ‡è¯†æ¨¡å—çš„åŠŸèƒ½ç±»å‹
  ModuleType type;

  // 2. æ¨¡å—IDï¼šæ”¯æŒåŒç±»å‹å¤šå®ä¾‹
  String moduleId;

  // 3. æ•°æ®å­˜å‚¨ï¼šæ¨¡å—ç‰¹å®šçš„æ•°æ®å†…å®¹
  Map<String, dynamic> data;

  // 4. ç±»å‹å®‰å…¨ï¼šæ”¯æŒå¼ºç±»å‹çš„æ¨¡å—é…ç½®
  T getTypedData<T>();
}
```

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒç±»å‹å®‰å…¨çš„æ¨¡å—é…ç½®
- ç»Ÿä¸€çš„æ¨¡å—æ¥å£å’Œæ•°æ®è®¿é—®
- åŠ¨æ€æ¨¡å—åŠ è½½å’Œé…ç½®

## 3. æ•°æ®æ¨¡å‹ç³»ç»Ÿ

### 3.1 æ•°æ®æ¨¡å‹æ¶æ„

é¡¹ç›®é‡‡ç”¨ä¸“ç”¨çš„æ•°æ®æ¨¡å‹ï¼Œæä¾›ç±»å‹å®‰å…¨å’Œç»“æ„åŒ–çš„æ•°æ®è®¿é—®ï¼š

| æ¨¡å—ç±»å‹ | æ•°æ®æ¨¡å‹ | æ ¸å¿ƒå­—æ®µ | ç‰¹æ®ŠåŠŸèƒ½ |
|---------|----------|----------|----------|
| **Logoæ¨¡å—** | `LogoData` | logoUrl, width, height | æ”¯æŒåŠ¨æ€å°ºå¯¸é…ç½® |
| **æ ‡é¢˜æ¨¡å—** | `TitleData` | titles, color, alignment | æ”¯æŒåŠ¨æ€é¢œè‰²å’Œå¯¹é½ |
| **ä¸»è¡¨æ¨¡å—** | `MainTableData` | fields, showBorder, showInnerBorder | ç»Ÿä¸€çš„è¡¨æ ¼æ•°æ®æ¨¡å‹ |
| **é¡µè„šæ¨¡å—** | `MainTableData` | fields, fieldsPerRow, showBorder | ä¸ä¸»è¡¨å…±äº«æ•°æ®æ¨¡å‹ |
| **å­è¡¨æ¨¡å—** | `SubTableData` | headers, rows, title, columnWidths | ç»“æ„åŒ–è¡¨æ ¼æ•°æ® |
| **å®¡æ‰¹æ¨¡å—** | `SubTableData` | headers, rows, title | ä¸å­è¡¨å…±äº«æ•°æ®æ¨¡å‹ |

### 3.2 TableField æ•°æ®ç»“æ„

æ‰€æœ‰è¡¨æ ¼æ•°æ®éƒ½åŸºäº `TableField` ç»“æ„ï¼Œæ”¯æŒä¸°å¯Œçš„å†…å®¹ç±»å‹ï¼š

```dart
class TableField {
  final String label;        // å­—æ®µæ ‡ç­¾
  final String value;        // æ˜¾ç¤ºå€¼
  final Content? content;    // å†…å®¹å¯¹è±¡ï¼ˆæ–‡æœ¬/å›¾ç‰‡ï¼‰
  final double? widthPercent; // åˆ—å®½ç™¾åˆ†æ¯”
  final int sort;            // æ’åºæƒé‡
}

// å†…å®¹ç±»å‹æ”¯æŒ
abstract class Content {
  // æ–‡æœ¬å†…å®¹
  TextContent(String text);

  // å›¾ç‰‡å†…å®¹
  ImageContent({
    required String imageUrl,
    String? altText,
    double? maxHeight,
  });
}
```

### 3.3 æ™ºèƒ½æ•°æ®è§£æ

`SubTableData` å…·å¤‡å¼ºå¤§çš„æ™ºèƒ½æ•°æ®è§£æèƒ½åŠ›ï¼š

```dart
// è¾“å…¥ï¼šå¤æ‚çš„åŸå§‹æ•°æ®
final rawData = [
  {
    'projectName': 'Flutter PDF ç»„ä»¶',
    'status': 'å·²å‘å¸ƒ',
    'image': {
      'imageUrl': 'https://picsum.photos/200/150?random=1',
      'altText': 'é¡¹ç›®æˆªå›¾',
      'maxHeight': 80.0,
    },
    'description': {
      'value': 'æ”¯æŒå›¾ç‰‡å±•ç¤ºçš„PDFç”Ÿæˆç»„ä»¶',
      'widthPercent': 0.4,
      'sort': 1,
    },
  },
];

// æ™ºèƒ½è§£æç»“æœï¼šå®Œæ•´çš„ TableField ç»“æ„
// è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡URLã€ä¿å­˜åˆ—å®½ä¿¡æ¯ã€æ’åºæƒé‡ç­‰
```

### 3.4 æ•°æ®ç±»å‹è¯†åˆ«

è§£æå™¨èƒ½å¤Ÿæ™ºèƒ½è¯†åˆ«ä¸åŒç±»å‹çš„æ•°æ®ï¼š

- **ç®€å•æ–‡æœ¬**ï¼š`'fieldName': 'simple text'` â†’ TextContent
- **å›¾ç‰‡URL**ï¼š`'image': 'https://example.com/image.jpg'` â†’ ImageContent
- **å¤æ‚å¯¹è±¡**ï¼šåŒ…å« widthPercentã€sort ç­‰é…ç½®çš„ Map å¯¹è±¡
- **æ— æŸè½¬æ¢**ï¼šå®Œæ•´ä¿å­˜å›¾ç‰‡ä¿¡æ¯ã€åˆ—å®½ä¿¡æ¯ã€æ’åºä¿¡æ¯ç­‰

## 4. æ¨¡å—ç³»ç»Ÿè¯¦è§£

### 4.1 æ¨¡å—æ¶æ„è®¾è®¡

é¡¹ç›®æ”¯æŒ6ç§æ ¸å¿ƒæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’Œä¼˜å…ˆçº§ï¼š

| æ¨¡å—ç±»å‹ | å®ç°ç±» | åŠŸèƒ½æè¿° | é»˜è®¤ä¼˜å…ˆçº§ | ä¾èµ–ç»„ä»¶ |
|---------|--------|----------|-----------|----------|
| **Logoæ¨¡å—** | `LogoModule` | æ˜¾ç¤ºå…¬å¸Logoæˆ–å›¾ç‰‡ | 1 | - |
| **æ ‡é¢˜æ¨¡å—** | `TitleModule` | æ˜¾ç¤ºæ–‡æ¡£æ ‡é¢˜ | 2 | - |
| **ä¸»è¡¨æ¨¡å—** | `MainTableModule` | æ˜¾ç¤ºä¸»è¦ä¸šåŠ¡æ•°æ®è¡¨æ ¼ | 3 | `CustomTableLayout` |
| **å­è¡¨æ¨¡å—** | `SubTableModule` | æ˜¾ç¤ºè¯¦ç»†æ•°æ®åˆ—è¡¨ï¼ˆæ”¯æŒå›¾ç‰‡ï¼‰ | 4 | `CustomTableLayout`, `CellRenderer` |
| **å®¡æ‰¹æ¨¡å—** | `SubTableModule` | æ˜¾ç¤ºå®¡æ‰¹è®°å½• | 5 | `CustomTableLayout` |
| **é¡µè„šæ¨¡å—** | `FooterModule` | æ˜¾ç¤ºé¡µè„šä¿¡æ¯ | 6 | - |

### 4.2 æ¨¡å—åŸºç±»æ¥å£

æ‰€æœ‰æ¨¡å—éƒ½å®ç°ç»Ÿä¸€çš„ `PDFModule` æ¥å£ï¼š

```dart
abstract class PDFModule {
  /// æ¸²æŸ“æ¨¡å—å†…å®¹
  Future<List<pw.Widget>> render(
    ModuleDescriptor descriptor,  // ç»Ÿä¸€çš„æ•°æ®æ¥å£
    PDFContext context,          // è¿è¡Œæ—¶ä¸Šä¸‹æ–‡
  );

  /// æ£€æŸ¥æ˜¯å¦å¯ä»¥æ¸²æŸ“è¯¥æ•°æ®
  bool canRender(ModuleDescriptor descriptor);

  /// è·å–æ¨¡å—ä¼˜å…ˆçº§
  int get priority;

  /// è·å–æ¨¡å—ID
  String get moduleId;
}
```

### 4.3 æ¨¡å—é—´ä¾èµ–å…³ç³»

```dart
// å­è¡¨æ¨¡å—çš„ä¾èµ–å…³ç³»ç¤ºä¾‹
class SubTableModule implements PDFModule {
  // ä¾èµ–ï¼šè‡ªå®šä¹‰è¡¨æ ¼å¸ƒå±€ç»„ä»¶
  final CustomTableLayout _tableLayout;

  // ä¾èµ–ï¼šå•å…ƒæ ¼æ¸²æŸ“å™¨ï¼ˆæ”¯æŒå›¾ç‰‡ï¼‰
  final CellRenderer _cellRenderer;

  @override
  Future<List<pw.Widget>> render(ModuleDescriptor descriptor, PDFContext context) async {
    // 1. ä½¿ç”¨è¡¨æ ¼å¸ƒå±€ç»„ä»¶æ„å»ºè¡¨æ ¼ç»“æ„
    final tableWidget = await _tableLayout.buildTableWithFields(
      headers, tableFieldRows, context
    );

    // 2. å•å…ƒæ ¼æ¸²æŸ“å™¨å¤„ç†å›¾ç‰‡å’Œæ–‡æœ¬å†…å®¹
    // 3. è¿”å›å®Œæ•´çš„è¡¨æ ¼ç»„ä»¶
    return [tableWidget];
  }
}
```

### 4.4 æ¨¡å—é…ç½®ç³»ç»Ÿ

æ¯ä¸ªæ¨¡å—é€šè¿‡ `AdapterModuleConfig` è¿›è¡Œé…ç½®ï¼š

```dart
AdapterModuleConfig(
  moduleType: ModuleType.subTable,    // æ¨¡å—ç±»å‹
  fieldConfigs: [...],                 // å­—æ®µçº§é…ç½®
  moduleConfig: SubTableConfig(        // æ¨¡å—ç‰¹å®šé…ç½®
    enabled: true,                     // æ˜¯å¦å¯ç”¨
    priority: 4,                       // æ˜¾ç¤ºä¼˜å…ˆçº§
    required: false,                   // æ˜¯å¦å¿…éœ€
    // å…¶ä»–å­è¡¨ç‰¹å®šé…ç½®...
  ),
)
```

## 5. å›¾ç‰‡å±•ç¤ºåŠŸèƒ½

### 5.1 å›¾ç‰‡åŠŸèƒ½æ¶æ„

å­è¡¨ç»„ä»¶çš„å›¾ç‰‡å±•ç¤ºåŠŸèƒ½åŸºäºä»¥ä¸‹ç»„ä»¶åä½œå®ç°ï¼š

```dart
SubTableModule                    // å­è¡¨æ¨¡å—
    â†“
CustomTableLayout                 // è¡¨æ ¼å¸ƒå±€ç»„ä»¶
    â†“
CellRenderer                      // å•å…ƒæ ¼æ¸²æŸ“å™¨
    â†“
ImageContent                      // å›¾ç‰‡å†…å®¹å¯¹è±¡
```

### 5.2 å›¾ç‰‡æ•°æ®æ ¼å¼

æ”¯æŒä¸¤ç§å›¾ç‰‡æ•°æ®æ ¼å¼ï¼š

```dart
// 1. ç®€å•URLæ ¼å¼ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰
{
  'é¡¹ç›®': 'ç§»åŠ¨åº”ç”¨å¼€å‘',
  'å›¾ç‰‡': 'https://picsum.photos/200/150?random=1',
  'çŠ¶æ€': 'è¿›è¡Œä¸­',
}

// 2. è¯¦ç»†é…ç½®æ ¼å¼
{
  'é¡¹ç›®': 'ç§»åŠ¨åº”ç”¨å¼€å‘',
  'å›¾ç‰‡': {
    'imageUrl': 'https://picsum.photos/200/150?random=1',
    'altText': 'é¡¹ç›®æˆªå›¾',        // åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤º
    'maxHeight': 80.0,           // æœ€å¤§é«˜åº¦é™åˆ¶
  },
  'çŠ¶æ€': 'è¿›è¡Œä¸­',
}
```

### 5.3 å›¾ç‰‡æ¸²æŸ“ç‰¹æ€§

- **è‡ªé€‚åº”ç¼©æ”¾**ï¼šå›¾ç‰‡è‡ªåŠ¨æ’‘æ»¡åˆ—å®½ï¼Œé«˜åº¦æŒ‰æ¯”ä¾‹è‡ªé€‚åº”
- **é«˜åº¦é™åˆ¶**ï¼šæ”¯æŒ `maxHeight` å‚æ•°é™åˆ¶æœ€å¤§æ˜¾ç¤ºé«˜åº¦
- **é™çº§æ˜¾ç¤º**ï¼šåŠ è½½å¤±è´¥æ—¶æ˜¾ç¤º `altText` æ›¿ä»£æ–‡æœ¬
- **å¸ƒå±€ä¿æŠ¤**ï¼šç¡®ä¿å›¾ç‰‡ä¸ç ´åè¡¨æ ¼å¸ƒå±€ç»“æ„

### 5.4 å›¾ç‰‡åˆ—é…ç½®å»ºè®®

```dart
// ä¸ºå›¾ç‰‡å­—æ®µé…ç½®åˆé€‚çš„åˆ—å®½
FieldConfig(
  fieldKey: 'å›¾ç‰‡',
  widthPercent: 0.25,    // æ¨è 20%-30% çš„åˆ—å®½
  sort: 2,               // é€‚å½“çš„æ’åºæƒé‡
)
```

**é…ç½®è¦ç‚¹**ï¼š
- å›¾ç‰‡åˆ—å®½å»ºè®®èŒƒå›´ï¼š0.2-0.3ï¼ˆ20%-30%ï¼‰
- å›¾ç‰‡é«˜åº¦å»ºè®®èŒƒå›´ï¼š60-100åƒç´ 
- å¿…é¡»æä¾›æœ‰æ„ä¹‰çš„ `altText` ä½œä¸ºé™çº§æ˜¾ç¤º

## 6. é…ç½®ç®¡ç†ç³»ç»Ÿ

### 6.1 é…ç½®æ¶æ„å±‚æ¬¡

é¡¹ç›®é‡‡ç”¨å¤šå±‚æ¬¡çš„é…ç½®ç®¡ç†ç³»ç»Ÿï¼š

```dart
PDFConfig                         // PDFæ–‡æ¡£çº§é…ç½®
    â”œâ”€â”€ é¡µé¢è®¾ç½® (PageFormat, Orientation)
    â”œâ”€â”€ ä¸»é¢˜é…ç½® (Theme, Colors)
    â””â”€â”€ æ°´å°é…ç½® (WatermarkConfig)

DataAdapterConfig                 // æ•°æ®é€‚é…å™¨é…ç½®
    â”œâ”€â”€ å­—æ®µæ ‡ç­¾æ˜ å°„ (FieldLabelConfig)
    â””â”€â”€ æ¨¡å—é…ç½® (ModuleConfigs)

AdapterModuleConfig              // å•ä¸ªæ¨¡å—é…ç½®
    â”œâ”€â”€ æ¨¡å—ç±»å‹ (moduleType)
    â”œâ”€â”€ å­—æ®µé…ç½® (FieldConfig[])
    â””â”€â”€ æ¨¡å—é…ç½® (moduleConfig: BaseModuleConfig)
```

### 6.2 å­—æ®µçº§é…ç½®

é€šè¿‡ `FieldConfig` å®ç°å­—æ®µçº§åˆ«çš„ç²¾ç»†æ§åˆ¶ï¼š

```dart
FieldConfig(
  fieldKey: 'projectName',        // å­—æ®µé”®å
  widthPercent: 0.3,              // åˆ—å®½ç™¾åˆ†æ¯”
  sort: 5,                        // æ’åºæƒé‡ï¼ˆæ•°å€¼è¶Šå¤§è¶Šé å‰ï¼‰
)
```

### 6.3 æ¨¡å—é…ç½®ç³»ç»Ÿ

æ¯ä¸ªæ¨¡å—ä½¿ç”¨ç±»å‹å®‰å…¨çš„é…ç½®ç±»ï¼š

```dart
// å­è¡¨æ¨¡å—é…ç½®
moduleConfig: SubTableConfig(
  enabled: true,
  priority: 4,
  required: false,
  showBorder: true,              // æ˜¾ç¤ºè¾¹æ¡†
  showTitle: true,               // æ˜¾ç¤ºæ ‡é¢˜
  titleText: 'é¡¹ç›®åˆ—è¡¨',         // æ ‡é¢˜æ–‡æœ¬
  // åˆ—å®½é€šè¿‡ fieldConfigs é…ç½®
)

// ä¸»è¡¨æ¨¡å—é…ç½®
moduleConfig: MainTableConfig(
  enabled: true,
  priority: 3,
  required: false,
  showBorder: true,              // æ˜¾ç¤ºè¾¹æ¡†
  maxColumnsPerRow: 3,           // æ¯è¡Œå­—æ®µæ•°
  cellPadding: EdgeInsets.all(8), // å•å…ƒæ ¼å†…è¾¹è·
)
```

### 6.4 é…ç½®ä¼˜å…ˆçº§

é…ç½®éµå¾ªä»¥ä¸‹ä¼˜å…ˆçº§è§„åˆ™ï¼š

1. **å­—æ®µæ•°æ®** > å­—æ®µé…ç½® > æ¨¡å—é…ç½® > ä¸»é¢˜é»˜è®¤å€¼
2. **FieldConfig** > moduleConfig > ç³»ç»Ÿé»˜è®¤å€¼
3. **ç”¨æˆ·ä¼ å…¥** > é€‚é…å™¨é»˜è®¤å€¼

```dart
// ç¤ºä¾‹ï¼šåˆ—å®½çš„ä¼˜å…ˆçº§
final width = fieldData.widthPercent ??     // 1. æ•°æ®ä¸­çš„åˆ—å®½
              fieldConfig.widthPercent ??   // 2. å­—æ®µé…ç½®ä¸­çš„åˆ—å®½
              moduleConfig.defaultWidth ??  // 3. æ¨¡å—é…ç½®ä¸­çš„é»˜è®¤å€¼
              defaultWidth;                 // 4. ç³»ç»Ÿé»˜è®¤å€¼
```

## 7. å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

### 7.1 å¿«é€Ÿå…¥é—¨ç¤ºä¾‹

```dart
import 'package:pdf_export_print/pdf_export_print.dart' as pdf;

// 1. åˆ›å»ºé€‚é…å™¨é…ç½®
final config = pdf.DataAdapterConfig(
  fieldLabelConfig: pdf.FieldLabelConfig.custom({
    'projectName': 'é¡¹ç›®åç§°',
    'image': 'é¡¹ç›®å›¾ç‰‡',
    'status': 'çŠ¶æ€',
    'progress': 'è¿›åº¦',
  }),
  moduleConfigs: {
    pdf.ModuleType.title: const pdf.AdapterModuleConfig(
      moduleType: pdf.ModuleType.title,
      enabled: true,
      priority: 1,
    ),
    pdf.ModuleType.subTable: const pdf.AdapterModuleConfig(
      moduleType: pdf.ModuleType.subTable,
      enabled: true,
      priority: 2,
      fieldConfigs: [
        pdf.FieldConfig(fieldKey: 'projectName', widthPercent: 0.3, sort: 1),
        pdf.FieldConfig(fieldKey: 'image', widthPercent: 0.25, sort: 2),
        pdf.FieldConfig(fieldKey: 'status', widthPercent: 0.2, sort: 3),
        pdf.FieldConfig(fieldKey: 'progress', widthPercent: 0.25, sort: 4),
      ],
    ),
  },
);

// 2. åˆ›å»ºæ•°æ®é€‚é…å™¨
final adapter = pdf.TypeSafeDataAdapter(config: config);

// 3. å‡†å¤‡ä¸šåŠ¡æ•°æ®
final businessData = {
  'titles': ['é¡¹ç›®ç®¡ç†æŠ¥å‘Š', '2024å¹´åº¦æ€»ç»“'],
  'details': [
    {
      'projectName': 'ç§»åŠ¨åº”ç”¨å¼€å‘',
      'image': 'https://picsum.photos/200/150?random=1',
      'status': 'è¿›è¡Œä¸­',
      'progress': '75%',
    },
    {
      'projectName': 'Webå¹³å°å¼€å‘',
      'image': {
        'imageUrl': 'https://picsum.photos/200/150?random=2',
        'altText': 'Webå¹³å°æˆªå›¾',
        'maxHeight': 80.0,
      },
      'status': 'å·²å®Œæˆ',
      'progress': '100%',
    },
  ],
};

// 4. åˆ›å»ºPDFæ„å»ºå™¨
final pdfBuilder = pdf.PDFPrintBuilder()
    .withDataAdapter(adapter)
    .addModule(pdf.TitleModule())
    .addModule(pdf.SubTableModule());

// 5. ç”ŸæˆPDF
final pdfDocument = await pdfBuilder.build();
```

### 7.2 é«˜çº§é…ç½®ç¤ºä¾‹

```dart
// å®Œæ•´çš„ä¼ä¸šçº§é…ç½®ç¤ºä¾‹
class EnterpriseConfigHelper {
  static pdf.DataAdapterConfig createEnterpriseConfig() {
    return pdf.DataAdapterConfig(
      fieldLabelConfig: _createFieldLabels(),
      moduleConfigs: _createModuleConfigs(),
    );
  }

  static pdf.FieldLabelConfig _createFieldLabels() {
    return pdf.FieldLabelConfig.custom({
      // ä¸»è¡¨å­—æ®µ
      'employeeId': 'å‘˜å·¥ç¼–å·',
      'name': 'å§“å',
      'department': 'éƒ¨é—¨',
      'position': 'èŒä½',

      // å­è¡¨å­—æ®µ
      'projectName': 'é¡¹ç›®åç§°',
      'projectImage': 'é¡¹ç›®å›¾ç‰‡',
      'startDate': 'å¼€å§‹æ—¶é—´',
      'endDate': 'ç»“æŸæ—¶é—´',
      'status': 'çŠ¶æ€',
      'evaluation': 'è¯„ä»·',

      // å®¡æ‰¹å­—æ®µ
      'stepName': 'å®¡æ‰¹æ­¥éª¤',
      'approver': 'å®¡æ‰¹äºº',
      'approveTime': 'å®¡æ‰¹æ—¶é—´',
      'opinion': 'å®¡æ‰¹æ„è§',
    });
  }

  static Map<pdf.ModuleType, pdf.AdapterModuleConfig> _createModuleConfigs() {
    return {
      pdf.ModuleType.logo: const pdf.AdapterModuleConfig(
        moduleType: pdf.ModuleType.logo,
        moduleConfig: pdf.LogoConfig(
          enabled: true,
          priority: 1,
          defaultWidth: 120.0,
          defaultHeight: 60.0,
        ),
      ),

      pdf.ModuleType.title: const pdf.AdapterModuleConfig(
        moduleType: pdf.ModuleType.title,
        moduleConfig: pdf.TitleConfig(
          enabled: true,
          priority: 2,
          color: 'darkBlue',
          // alignment é…ç½®åœ¨ TitleConfig ä¸­
        ),
      ),

      pdf.ModuleType.subTable: const pdf.AdapterModuleConfig(
        moduleType: pdf.ModuleType.subTable,
        fieldConfigs: [
          pdf.FieldConfig(fieldKey: 'projectName', widthPercent: 0.25, sort: 1),
          pdf.FieldConfig(fieldKey: 'projectImage', widthPercent: 0.2, sort: 2),
          pdf.FieldConfig(fieldKey: 'startDate', widthPercent: 0.15, sort: 3),
          pdf.FieldConfig(fieldKey: 'endDate', widthPercent: 0.15, sort: 4),
          pdf.FieldConfig(fieldKey: 'status', widthPercent: 0.15, sort: 5),
          pdf.FieldConfig(fieldKey: 'evaluation', widthPercent: 0.1, sort: 6),
        ],
        moduleConfig: pdf.SubTableConfig(
          enabled: true,
          priority: 4,
          showTitle: true,
          titleText: 'é¡¹ç›®ç»å†',
        ),
      ),
    };
  }
}

### 7.3 å¢å¼ºå­—æ®µæ ‡ç­¾é…ç½®

ä» v0.0.1 ç‰ˆæœ¬å¼€å§‹ï¼Œ`FieldLabelConfig` æ”¯æŒå¢å¼ºé…ç½®æ¨¡å¼ï¼Œå¯ä»¥è§£å†³ä¸»è¡¨å’Œå­è¡¨ç›¸åŒå­—æ®µkeyçš„æ ‡é¢˜å†²çªé—®é¢˜ã€‚

#### **é—®é¢˜åœºæ™¯**
åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä¸»è¡¨å’Œå­è¡¨å¯èƒ½å­˜åœ¨ç›¸åŒçš„å­—æ®µkeyï¼Œä½†éœ€è¦æ˜¾ç¤ºä¸åŒçš„æ ‡é¢˜ï¼š

```dart
// é—®é¢˜ï¼šä¸»è¡¨å’Œå­è¡¨éƒ½æœ‰'docNo'å­—æ®µï¼Œä½†æ ‡é¢˜éœ€æ±‚ä¸åŒ
// ä¸»è¡¨çš„'docNo' â†’ "å•æ®ç¼–å·"
// å­è¡¨'testDetails'çš„'docNo' â†’ "æµ‹è¯•ç¼–å·"
// å­è¡¨'monthPlanDetails'çš„'docNo' â†’ "è®¡åˆ’ç¼–å·"
```

#### **è§£å†³æ–¹æ¡ˆï¼šenhanced() é…ç½®**

ä½¿ç”¨ `FieldLabelConfig.enhanced()` æ–¹æ³•æ”¯æŒåˆ†å±‚æ˜ å°„ï¼š

```dart
final fieldLabels = pdf.FieldLabelConfig.enhanced(
  // å…¨å±€å­—æ®µæ˜ å°„ï¼ˆé€‚ç”¨äºæ‰€æœ‰æ¨¡å—ï¼‰
  globalMappings: {
    'name': 'å§“å',
    'age': 'å¹´é¾„',
    'department': 'éƒ¨é—¨',
    'docNo': 'å•æ®ç¼–å·',        // ä¸»è¡¨é»˜è®¤æ ‡é¢˜
    'remarks': 'å¤‡æ³¨',          // ä¸»è¡¨é»˜è®¤æ ‡é¢˜
  },
  // æ¨¡å—ç‰¹å®šæ˜ å°„ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
  moduleMappings: {
    'testDetails': {
      'docNo': 'æµ‹è¯•ç¼–å·',      // è¦†ç›–å…¨å±€æ˜ å°„
      'remarks': 'æµ‹è¯•å¤‡æ³¨',    // è¦†ç›–å…¨å±€æ˜ å°„
      'testResult': 'æµ‹è¯•ç»“æœ',
    },
    'monthPlanDetails': {
      'docNo': 'è®¡åˆ’ç¼–å·',      // è¦†ç›–å…¨å±€æ˜ å°„
      'remarks': 'è®¡åˆ’å¤‡æ³¨',    // è¦†ç›–å…¨å±€æ˜ å°„
      'planAmount': 'è®¡åˆ’é‡‘é¢',
    },
  },
);
```

#### **æŸ¥æ‰¾ä¼˜å…ˆçº§æœºåˆ¶**

å­—æ®µæ ‡ç­¾æŸ¥æ‰¾éµå¾ªä»¥ä¸‹ä¼˜å…ˆçº§ï¼š

1. **æ¨¡å—ç‰¹å®šæ˜ å°„**ï¼š`moduleMappings[moduleId][fieldKey]`
2. **å…¨å±€æ˜ å°„**ï¼š`globalMappings[fieldKey]`
3. **åŸå§‹å­—æ®µé”®**ï¼š`fieldKey`

```dart
// ç¤ºä¾‹ï¼šæŸ¥æ‰¾'docNo'å­—æ®µçš„æ ‡é¢˜
// åœ¨ä¸»è¡¨æ¨¡å—ä¸­ï¼šä½¿ç”¨å…¨å±€æ˜ å°„ â†’ "å•æ®ç¼–å·"
// åœ¨testDetailsæ¨¡å—ä¸­ï¼šä½¿ç”¨æ¨¡å—ç‰¹å®šæ˜ å°„ â†’ "æµ‹è¯•ç¼–å·"
// åœ¨monthPlanDetailsæ¨¡å—ä¸­ï¼šä½¿ç”¨æ¨¡å—ç‰¹å®šæ˜ å°„ â†’ "è®¡åˆ’ç¼–å·"
```

#### **å‘åå…¼å®¹æ€§**

ç°æœ‰çš„ `custom()` æ–¹æ³•å®Œå…¨ä¸å—å½±å“ï¼š

```dart
// ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œç»§ç»­æ­£å¸¸å·¥ä½œ
final fieldLabels = pdf.FieldLabelConfig.custom({
  'name': 'å‘˜å·¥å§“å',
  'department': 'æ‰€å±éƒ¨é—¨',
});
```

#### **API æ‰©å±•**

å¢å¼ºé…ç½®æä¾›äº†æ–°çš„APIæ–¹æ³•ï¼š

```dart
// æ”¯æŒæ¨¡å—ä¸Šä¸‹æ–‡çš„æ ‡ç­¾è·å–
String getLabelWithModule(String fieldKey, String moduleId);

// æ£€æŸ¥æ˜ å°„å­˜åœ¨æ€§ï¼ˆæ”¯æŒæ¨¡å—ä¸Šä¸‹æ–‡ï¼‰
bool hasMapping(String fieldKey, {String? moduleId});

// è·å–æ‰€æœ‰æ¨¡å—æ˜ å°„
Map<String, Map<String, String>> get allModuleMappings;
```

## 8. å¼€å‘è€…æ‰©å±•æŒ‡å—

### 8.1 è‡ªå®šä¹‰æ¨¡å—å¼€å‘

å¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° `PDFModule` æ¥å£æ¥åˆ›å»ºè‡ªå®šä¹‰æ¨¡å—ï¼š

```dart
class CustomChartModule implements PDFModule {
  @override
  String get moduleId => 'custom_chart';

  @override
  int get priority => 10;

  @override
  bool canRender(ModuleDescriptor descriptor) {
    return descriptor.type == ModuleType.subTable &&
           descriptor.data.containsKey('chartData');
  }

  @override
  Future<List<pw.Widget>> render(ModuleDescriptor descriptor, PDFContext context) async {
    final chartData = descriptor.data['chartData'] as Map<String, dynamic>;

    // å®ç°å›¾è¡¨æ¸²æŸ“é€»è¾‘
    return [
      pw.Container(
        height: 200,
        child: pw.Text('è‡ªå®šä¹‰å›¾è¡¨: ${chartData['title']}'),
      ),
    ];
  }
}

// ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—
final pdfBuilder = pdf.PDFPrintBuilder()
    .addModule(CustomChartModule())
    .addModule(pdf.TitleModule());
```

### 8.2 è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“å™¨

æ‰©å±•å•å…ƒæ ¼æ¸²æŸ“å™¨ä»¥æ”¯æŒæ–°çš„å†…å®¹ç±»å‹ï¼š

```dart
class CustomCellRenderer extends CellRenderer {
  @override
  Future<pw.Widget> renderContent(Content content, double maxWidth, PDFContext context) async {
    if (content is QRCodeContent) {
      // æ¸²æŸ“äºŒç»´ç 
      return pw.Container(
        width: maxWidth,
        height: 60,
        child: pw.Text('QR Code: ${content.data}'),
      );
    }

    // è°ƒç”¨çˆ¶ç±»å¤„ç†å…¶ä»–ç±»å‹
    return super.renderContent(content, maxWidth, context);
  }
}

// è‡ªå®šä¹‰å†…å®¹ç±»å‹
class QRCodeContent extends Content {
  final String data;
  QRCodeContent(this.data);
}
```

### 8.3 è‡ªå®šä¹‰ä¸»é¢˜å¼€å‘

åˆ›å»ºè‡ªå®šä¹‰ä¸»é¢˜ä»¥æ»¡è¶³ä¼ä¸šå“ç‰Œéœ€æ±‚ï¼š

```dart
class CustomCorporateTheme extends StyleTheme {
  @override
  PdfColor get primaryColor => PdfColors.deepPurple;

  @override
  PdfColor get secondaryColor => PdfColors.amber;

  @override
  double get titleFontSize => 22.0;

  @override
  double get headerFontSize => 14.0;

  @override
  double get bodyFontSize => 11.0;

  @override
  EdgeInsets get defaultPadding => const EdgeInsets.all(12);
}

// åº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜
final config = pdf.PDFConfig.builder()
    .theme(CustomCorporateTheme())
    .build();
```

### 8.4 æ‰©å±•æ•°æ®é€‚é…å™¨

ä¸ºç‰¹æ®Šæ•°æ®æºåˆ›å»ºä¸“ç”¨é€‚é…å™¨ï¼š

```dart
class DatabaseDataAdapter extends TypeSafeDataAdapter {
  final DatabaseConnection db;

  DatabaseDataAdapter(this.db, {required DataAdapterConfig config})
      : super(config: config);

  @override
  ModuleDescriptor? adaptModuleData(ModuleDescriptor descriptor) {
    // ä»æ•°æ®åº“åŠ è½½å…³è”æ•°æ®
    final enrichedDescriptor = _enrichDescriptorFromDatabase(descriptor);

    // è°ƒç”¨çˆ¶ç±»è¿›è¡Œæ ‡å‡†é€‚é…
    return super.adaptModuleData(enrichedDescriptor);
  }

  ModuleDescriptor _enrichDescriptorFromDatabase(ModuleDescriptor descriptor) {
    // å®ç°æ•°æ®åº“æ•°æ®å¢å¼ºé€»è¾‘
    return descriptor;
  }
}

## 9. æœ€ä½³å®è·µ

### 9.1 æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

#### **æ¨¡å—åŒ–è®¾è®¡åŸåˆ™**
```dart
// âœ… æ¨èï¼šæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç 
class ProjectPDFService {
  final PDFPrintBuilder _pdfBuilder;
  final TypeSafeDataAdapter _dataAdapter;
  final DataAdapterConfig _config;

  // èŒè´£å•ä¸€ï¼šä¸“æ³¨äºPDFç”Ÿæˆ
  Future<Document> generateProjectReport(Map<String, dynamic> data) async {
    // åˆ›å»ºæ¨¡å—æè¿°ç¬¦
    final moduleDescriptor = ModuleDescriptor(
      ModuleType.subTable,
      'project_report',
      data,
    );
    final adaptedModule = _dataAdapter.adaptModule(moduleDescriptor);
    if (adaptedModule != null) {
      _pdfBuilder.addModule(adaptedModule);
    }
    return await _pdfBuilder.build();
  }
}

// âŒ é¿å…ï¼šå°†æ‰€æœ‰é€»è¾‘æ··åˆåœ¨ä¸€ä¸ªç±»ä¸­
class MonolithicPDFService {
  // èŒè´£æ··ä¹±ï¼šæ•°æ®å¤„ç†ã€é…ç½®ç®¡ç†ã€PDFç”Ÿæˆéƒ½åœ¨ä¸€èµ·
}
```

#### **ä¾èµ–æ³¨å…¥æ¨¡å¼**
```dart
// âœ… æ¨èï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥æé«˜å¯æµ‹è¯•æ€§
class PDFService {
  final DataAdapter dataAdapter;
  final ConfigProvider configProvider;

  PDFService({
    required this.dataAdapter,
    required this.configProvider,
  });
}

// åœ¨åº”ç”¨ä¸­æ³¨å†Œä¾èµ–
final pdfService = PDFService(
  dataAdapter: TypeSafeDataAdapter(config: appConfig),
  configProvider: AppConfigProvider(),
);
```

### 9.2 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

#### **é…ç½®ç¼“å­˜ç­–ç•¥**
```dart
class ConfigCache {
  static final Map<String, DataAdapterConfig> _cache = {};

  static DataAdapterConfig getConfig(String key) {
    return _cache.putIfAbsent(key, () => _createConfig(key));
  }

  static DataAdapterConfig _createConfig(String key) {
    // åˆ›å»ºé…ç½®çš„å¼€é”€è¾ƒå¤§ï¼Œåº”è¯¥ç¼“å­˜
    return DataAdapterConfig(/* ... */);
  }
}
```

#### **å›¾ç‰‡èµ„æºç®¡ç†**
```dart
// âœ… æ¨èï¼šåˆç†çš„å›¾ç‰‡å°ºå¯¸å’Œæ ¼å¼
final imageConfig = {
  'imageUrl': 'https://cdn.example.com/optimized-image.jpg', // ä½¿ç”¨CDN
  'maxHeight': 80.0,                                         // é™åˆ¶é«˜åº¦
  'altText': 'é¡¹ç›®æˆªå›¾',                                     // æä¾›é™çº§æ–‡æœ¬
};

// âŒ é¿å…ï¼šè¿‡å¤§çš„å›¾ç‰‡å½±å“æ€§èƒ½
final badImageConfig = {
  'imageUrl': 'https://example.com/huge-image.png',  // é¿å…å¤§å›¾ç‰‡
  'maxHeight': 500.0,                                // é¿å…è¿‡é«˜
};
```

### 9.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

#### **åˆ†å±‚é”™è¯¯å¤„ç†**
```dart
class PDFGenerationService {
  Future<Result<Document, PDFError>> generatePDF(Map<String, dynamic> data) async {
    try {
      // 1. æ•°æ®éªŒè¯å±‚
      final validationResult = await _validateData(data);
      if (validationResult.isFailure) {
        return Result.failure(PDFError.validation(validationResult.error));
      }

      // 2. æ¨¡å—é€‚é…å±‚
      final moduleDescriptor = ModuleDescriptor(
        ModuleType.mainTable,
        'main_data',
        data,
      );
      final adaptedModule = _dataAdapter.adaptModule(moduleDescriptor);

      // 3. PDFç”Ÿæˆå±‚
      if (adaptedModule != null) {
        _pdfBuilder.addModule(adaptedModule);
      }
      final document = await _pdfBuilder.build();

      return Result.success(document);

    } on NetworkException catch (e) {
      return Result.failure(PDFError.network(e.message));
    } on ValidationException catch (e) {
      return Result.failure(PDFError.validation(e.message));
    } catch (e) {
      return Result.failure(PDFError.unknown(e.toString()));
    }
  }
}
```

### 9.4 æµ‹è¯•æœ€ä½³å®è·µ

#### **å•å…ƒæµ‹è¯•æ¨¡å—**
```dart
void main() {
  group('SubTableModule Tests', () {
    late SubTableModule module;
    late MockPDFContext context;

    setUp(() {
      module = SubTableModule();
      context = MockPDFContext();
    });

    test('should render table with images', () async {
      // Given
      final descriptor = createTestSubTableDescriptor();

      // When
      final widgets = await module.render(descriptor, context);

      // Then
      expect(widgets, isNotEmpty);
      expect(widgets.first, isA<pw.Table>());
    });
  });
}
```

## 10. æ•…éšœæ’é™¤

### 10.1 å¸¸è§é—®é¢˜è¯Šæ–­

#### **Q1: å­—æ®µæ ‡ç­¾æ˜¾ç¤ºä¸ºåŸå§‹é”®åï¼Ÿ**
**åŸå› **: ç¼ºå°‘å­—æ®µæ ‡ç­¾æ˜ å°„é…ç½®
**è§£å†³æ–¹æ¡ˆ**:
```dart
final fieldLabels = pdf.FieldLabelConfig.custom({
  'name': 'å‘˜å·¥å§“å',        // å°†'name'æ˜ å°„ä¸º'å‘˜å·¥å§“å'
  'department': 'æ‰€å±éƒ¨é—¨',  // å°†'department'æ˜ å°„ä¸º'æ‰€å±éƒ¨é—¨'
});
```

#### **Q2: æ¨¡å—ä¸æ˜¾ç¤ºï¼Ÿ**
**è¯Šæ–­æ­¥éª¤**:
1. æ£€æŸ¥æ¨¡å—æ˜¯å¦å¯ç”¨ï¼š`enabled: true`
2. æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®æä¾›
3. æ£€æŸ¥æ¨¡å—é…ç½®æ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥é…ç½®éªŒè¯ç»“æœ

```dart
// è°ƒè¯•ä»£ç 
final validationResult = adapter.validationResult;
if (!validationResult.isValid) {
  print('é…ç½®éªŒè¯å¤±è´¥: ${validationResult.errors.join(', ')}');
}
print('æ”¯æŒçš„æ¨¡å—: ${adapter.getSupportedModules()}');
```

#### **Q3: å›¾ç‰‡ä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºä¸ºå ä½ç¬¦ï¼Ÿ**
**è¯Šæ–­æ­¥éª¤**:
1. **æ£€æŸ¥å›¾ç‰‡URL**: ç¡®ä¿URLå¯è®¿é—®ï¼Œæ”¯æŒHTTPS
2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**: å›¾ç‰‡åŠ è½½éœ€è¦ç½‘ç»œè®¿é—®æƒé™
3. **éªŒè¯å›¾ç‰‡æ ¼å¼**: æ”¯æŒjpgã€jpegã€pngã€gifã€bmpã€webpæ ¼å¼
4. **æ£€æŸ¥å­—æ®µé…ç½®**: ç¡®ä¿å›¾ç‰‡å­—æ®µæœ‰åˆé€‚çš„åˆ—å®½ï¼ˆå»ºè®®0.2-0.3ï¼‰

```dart
// âœ… æ­£ç¡®çš„å›¾ç‰‡é…ç½®
{
  'å›¾ç‰‡': {
    'imageUrl': 'https://picsum.photos/200/150?random=1',
    'altText': 'é¡¹ç›®æˆªå›¾',  // é‡è¦ï¼šæä¾›æ›¿ä»£æ–‡æœ¬
    'maxHeight': 80.0,
  },
}

// âŒ å¸¸è§é”™è¯¯
{
  'å›¾ç‰‡': 'invalid-url',  // URLæ— æ•ˆ
  // ç¼ºå°‘altTextï¼ŒåŠ è½½å¤±è´¥æ—¶ç”¨æˆ·ä½“éªŒå·®
}
```

#### **Q4: åˆ—å®½é…ç½®ä¸ç”Ÿæ•ˆï¼Ÿ**
**æ£€æŸ¥æ¸…å•**:
1. é…ç½®åœ¨ `fieldConfigs` ä¸­è€Œä¸æ˜¯ `customSettings`
2. å­—æ®µåä¸æ•°æ®ä¸­çš„é”®åä¸€è‡´
3. ç™¾åˆ†æ¯”æ€»å’Œä¸è¶…è¿‡1.0
4. ä½¿ç”¨æ­£ç¡®çš„é…ç½®å±‚çº§

```dart
// âœ… æ­£ç¡®çš„åˆ—å®½é…ç½®
fieldConfigs: [
  pdf.FieldConfig(fieldKey: 'projectName', widthPercent: 0.3, sort: 1),
  pdf.FieldConfig(fieldKey: 'image', widthPercent: 0.25, sort: 2),
]

// âŒ é”™è¯¯çš„é…ç½®ä½ç½®
customSettings: {
  'widthPercent': 0.3,  // åº”è¯¥åœ¨fieldConfigsä¸­
}
```

### 10.2 æ€§èƒ½é—®é¢˜æ’æŸ¥

#### **PDFç”Ÿæˆç¼“æ…¢**
**ä¼˜åŒ–ç­–ç•¥**:
1. **å›¾ç‰‡ä¼˜åŒ–**: ä½¿ç”¨é€‚å½“å°ºå¯¸çš„å›¾ç‰‡ï¼ˆæ¨è200x150åƒç´ ï¼‰
2. **é…ç½®ç¼“å­˜**: ç¼“å­˜é€‚é…å™¨é…ç½®ï¼Œé¿å…é‡å¤åˆ›å»º
3. **æ•°æ®é¢„å¤„ç†**: åœ¨UIçº¿ç¨‹å¤–é¢„å¤„ç†æ•°æ®
4. **æ¨¡å—æŒ‰éœ€åŠ è½½**: æ ¹æ®ä¸šåŠ¡éœ€è¦åŠ¨æ€å¯ç”¨æ¨¡å—

#### **å†…å­˜å ç”¨è¿‡é«˜**
**è§£å†³æ–¹æ¡ˆ**:
1. åŠæ—¶é‡Šæ”¾å¤§å‹PDFæ–‡æ¡£å¯¹è±¡
2. é¿å…åœ¨å†…å­˜ä¸­ä¿å­˜è¿‡å¤šå›¾ç‰‡æ•°æ®
3. ä½¿ç”¨æµå¼å¤„ç†å¤§é‡æ•°æ®

### 10.3 è°ƒè¯•æŠ€å·§

#### **å¯ç”¨è¯¦ç»†æ—¥å¿—**
```dart
// åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•ä¿¡æ¯
final adapter = TypeSafeDataAdapter(config: config);

// æ£€æŸ¥é…ç½®éªŒè¯ç»“æœ
final validationResult = adapter.validationResult;
if (!validationResult.isValid) {
  print('é…ç½®éªŒè¯å¤±è´¥: ${validationResult.errors.join(', ')}');
}
if (validationResult.warnings.isNotEmpty) {
  print('é…ç½®è­¦å‘Š: ${validationResult.warnings.join(', ')}');
}
```

#### **æ•°æ®éªŒè¯å·¥å…·**
```dart
bool validateBusinessData(Map<String, dynamic> data) {
  // æ£€æŸ¥å¿…éœ€çš„æ•°æ®é”®
  final requiredKeys = [
    'titles',
    'mainData',
  ];

  for (final key in requiredKeys) {
    if (!data.containsKey(key) || data[key] == null) {
      print('ç¼ºå°‘å¿…éœ€æ•°æ®: $key');
      return false;
    }
  }

  return true;
}
```

---

## ğŸ“š é™„å½•

### A. å¸¸é‡å‚è€ƒ

é¡¹ç›®æä¾›äº†ç»Ÿä¸€çš„å¸¸é‡ç®¡ç†ï¼Œé¿å…ç¡¬ç¼–ç æ•°å€¼ï¼š

| å¸¸é‡ç±» | ç”¨é€” | ä¸»è¦å¸¸é‡ |
|--------|------|----------|
| `LogoConstants` | Logoæ¨¡å— | defaultWidth, defaultHeight, smallWidth, largeWidth |
| `TitleConstants` | æ ‡é¢˜æ¨¡å— | defaultColor, defaultAlignment, defaultSpacing |
| `TableConstants` | è¡¨æ ¼æ¨¡å— | defaultCellPadding, defaultHeaderHeight, defaultRowHeight |
| `LayoutConstants` | å¸ƒå±€é€šç”¨ | defaultMargin, defaultFontSize, titleFontSize |

### B. ä»£ç å¼•ç”¨è§„èŒƒ

**âœ… æ­£ç¡®çš„å¯¼å…¥æ–¹å¼ï¼š**
```dart
import 'package:pdf_export_print/pdf_export_print.dart' as pdf;
```

**âœ… æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼ï¼š**
```dart
final adapter = pdf.TypeSafeDataAdapter(config: config);
final pdfBuilder = pdf.PDFPrintBuilder();
final moduleType = pdf.ModuleType.logo;
```

### C. ç‰ˆæœ¬æ›´æ–°è¯´æ˜

- **v2.0.0**: å¼•å…¥ç±»å‹å®‰å…¨æ¶æ„ï¼Œæ”¯æŒå›¾ç‰‡å±•ç¤ºåŠŸèƒ½
- **v1.5.0**: ä¼˜åŒ–è¡¨æ ¼ç»„ä»¶ï¼Œç§»é™¤å†—ä½™ä¾èµ–
- **v1.0.0**: åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€PDFç”ŸæˆåŠŸèƒ½

---

**æ„Ÿè°¢ä½¿ç”¨ PDF Export Printï¼**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š
- GitHub Issues: [é¡¹ç›®é—®é¢˜åé¦ˆ](https://github.com/your-repo/issues)
- æ–‡æ¡£æ›´æ–°: è¯·æŸ¥çœ‹ [CHANGELOG.md](../CHANGELOG.md) è·å–æœ€æ–°æ›´æ–°
- ç¤ºä¾‹ä»£ç : å‚è€ƒ [example/lib/main.dart](../example/lib/main.dart) è·å–å®Œæ•´ç¤ºä¾‹

*æœ€åæ›´æ–°: 2024-12-19 - åŸºäºä»£ç å…³ç³»å›¾è°±é‡å†™æ¶æ„æ–‡æ¡£ï¼Œæ–°å¢å¼€å‘è€…æ‰©å±•æŒ‡å—*










